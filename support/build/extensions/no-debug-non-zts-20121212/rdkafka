#!/usr/bin/env bash

dep_name=$(basename $BASH_SOURCE)

OUT_PREFIX=$1
export PATH=${OUT_PREFIX}/bin:${PATH}

# we need to declare the required version of librdkafka
dep_formula=${0#$WORKSPACE_DIR/}
dep_version=${dep_formula##*"/${dep_name}-"}
series=$(php-config --version | cut -d. -f1,2) # get "5.5", "5.6", "7.0" etc for the php requirement in the manifest
case "$dep_version" in
	*)
		MANIFEST_REQUIRE="${MANIFEST_REQUIRE:-"{\"heroku-sys/php\":\"${series}.*\",\"heroku-sys/librdkafka\":\"~0.9\",\"heroku-sys/librdkafka-abi\":\"^1\"}"}"
		;;
esac

CONFIGURE_EXTRA="--with-rdkafka=${OUT_PREFIX}"

source $(dirname $BASH_SOURCE)/../pecl
