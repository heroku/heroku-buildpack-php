name: Platform packages sync from -develop/ to -stable/
run-name: Sync${{ inputs.dry-run == true && ' dry-run' || '' }} from dist-$STACK-develop/ to dist-$STACK-stable/

env:
  stacks_list_for_shell_expansion: "{heroku-20,heroku-22,heroku-24-amd64,heroku-24-arm64}"
  src_path_suffix: "-develop/"
  dst_path_suffix: "-stable/"

on:
  workflow_dispatch:
    inputs:
      stack-heroku-20:
        description: 'Sync heroku-20 packages'
        type: boolean
        default: true
        required: false
      stack-heroku-22:
        description: 'Sync heroku-22 packages'
        type: boolean
        default: true
        required: false
      stack-heroku-24-amd64:
        description: 'Sync heroku-24 (amd64) packages'
        type: boolean
        default: true
        required: false
      stack-heroku-24-arm64:
        description: 'Sync heroku-24 (arm64) packages'
        type: boolean
        default: true
        required: false
      dry-run:
        description: 'Only list package changes, without syncing'
        type: boolean
        default: false
        required: false
      update-devcenter:
        description: 'Update "PHP Support" Dev Center article after sync'
        type: boolean
        default: true
        required: false

permissions:
  contents: read

jobs:
  matrix-test:
    runs-on: ubuntu-24.04
    strategy:
      matrix:
        environment: ["dev", "qa", "prod"]
        version: [1, 2]
        os: ["ubuntu-latest", "windows-latest"]
        include:
          - os: "windows-latest"
            version: 2
          - environment: "dev"
            experimental_feature: true
    steps:
      - name: Print
        run: echo "${{ toJson(matrix) }}"
